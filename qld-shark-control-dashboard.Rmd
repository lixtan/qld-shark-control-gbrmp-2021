---
title: "Queensland Shark Program 2021 Catches - Great Barrier Reef Marine Park"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
    orientation: rows
    source_code: embed
---

<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

my_packages <- c("tidyverse", "plotly", "flexdashboard", "lubridate", "treemap", "d3treeR") 
lapply(my_packages, require, character.only = TRUE)

catches2021 <- read.csv("gbrmp-catch-statistics-2021.csv")
```

About {.sidebar}
-------------------------------------
This dashboard provides summary statistics about the catches in the Queensland Shark program at the Great Barrier Reef Marine Park in 2021. Catch details include: species, date, area, location, fate and number. 

The data was obtained from [Queensland's Open Data Portal](https://www.data.qld.gov.au/dataset/qld-shark-control-program-catch-statistics-great-barrier-reef-marine-park).

Created by [Li X Tan](https://www.github.com/lixtan/). Last updated: 2022-04-17

Row
-----------------------------------------------------------------------
```{r total-calculations, include = FALSE}
total_catch <- nrow(catches2021)
commonwealth_catch <- nrow(catches2021[catches2021$Marine.Park == "Commonwealth",])
state_catch <- nrow(catches2021[catches2021$Marine.Park == "State",])
```

### Total catches in 2021
```{r total-catch-2021}
valueBox(value = paste0(total_catch), icon = "fa-ship")
```

### Catches in Commonwealth Marine Park
```{r commonwealth-catch-2021}
valueBox(value = paste0(commonwealth_catch), icon = "fa-arrows")
```

### Catches in State Marine Park
```{r state-catch-2021}
valueBox(value = paste0(state_catch), icon = "fa-arrows-alt")
```

Row
-----------------------------------------------------------------------
### Number of catches over time
```{r time-series}
catches2021$Date <- dmy(catches2021$Date)
count_catches <- catches2021 %>% count(Date, Area) %>% 
  group_by(Area, Date) %>%
  summarise(Value = sum(n)) %>%
  mutate(Value = cumsum(Value))

catches_time_series <- count_catches %>% ggplot(aes(x=Date, y=Value, group=Area, color=Area)) +
    geom_line(size = 1) +
    labs(y="Cumulative Number of Catches") +
    theme_minimal()
catches_time_series
ggplotly(catches_time_series, tooltip = c("x", "y", "group"))
```

Row {.tabset}
-----------------------------------------------------------------------
```{r setup-charts, include=FALSE}
catches_area <- catches2021 %>% count(Area, Location)
area_treemap <- treemap(catches_area,
            index=c("Area","Location"),
            vSize="n",
            type="index",
            palette = "Blues",
            bg.labels=c("white"),
            align.labels=list(
              c("center", "center"), 
              c("right", "bottom")
            )  
          )

species_fate <- catches2021 %>% count(Common.Name, Fate)
species_fate_chart <- ggplot(species_fate, aes(x = fct_reorder(Common.Name,n), y = n, fill = Fate)) + 
  coord_flip() +
  geom_bar(stat = "identity") +
  labs(x = "Number of catches", y = "Fish species - common name") +
  theme_minimal()
```

### Area
```{r area, echo = FALSE, fig.keep='none'}
d3tree2(area_treemap, rootname = "Catch Areas")
```

### Species & Fate
```{r fate, echo = FALSE}
ggplotly(species_fate_chart)
```

